<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>On The Bleeding Edge with WSL2 :: Pulse Code — Ben Coleman</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="I&#39;ve been a huge fan of WSL (Windows Subsystem for Linux) since it first came to Windows 10. In fact it&#39;s fair to say it has completely transformed how I do local development, run tools and my whole workflow. Naturally I was very interested in the news from Build announcing a new version of WSL, which seems to go by the rather functional (if descriptive) name &amp;ldquo;WSL2&amp;rdquo;
I&#39;m not going to get too deep into what&#39;s new and exciting with WSL2, as I think the announcement blog covers it nicely"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/blog/wsl2/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="On The Bleeding Edge with WSL2"/>
<meta name="twitter:description" content="I&#39;ve been a huge fan of WSL (Windows Subsystem for Linux) since it first came to Windows 10. In fact it&#39;s fair to say it has completely transformed how I do local development, run tools and my whole workflow. Naturally I was very interested in the news from Build announcing a new version of WSL, which seems to go by the rather functional (if descriptive) name &#34;WSL2&#34;"/>



<meta property="og:title" content="On The Bleeding Edge with WSL2" />
<meta property="og:description" content="I&#39;ve been a huge fan of WSL (Windows Subsystem for Linux) since it first came to Windows 10. In fact it&#39;s fair to say it has completely transformed how I do local development, run tools and my whole workflow. Naturally I was very interested in the news from Build announcing a new version of WSL, which seems to go by the rather functional (if descriptive) name &#34;WSL2&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/wsl2/" />
<meta property="article:published_time" content="2019-06-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-06-16T00:00:00+00:00" /><meta property="og:site_name" content="Pulse Code" />



<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.12.0/css/light.css" integrity="sha384-i+ivMdAc0+wLEnd+UdXLpYGNTbyn/0Rjz7EqmkqEOkfat5/2T+S63wn3WDk6h4Yh" crossorigin="anonymous">
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.12.0/css/fontawesome.css" integrity="sha384-CtsKDnRWWHDhjRZ5qgpCFCGpib2FU2SChFu0xRt81grgvXq1P+lbpROQoBLxlU4o" crossorigin="anonymous">
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.12.0/css/solid.css" integrity="sha384-U9f9KTMQ1TBvUUFLpp6FgAy1M59lrF3q3rYTHPRVtT8OzY3xyyFUzKevJFYHEbhq" crossorigin="anonymous">
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.12.0/css/brands.css" integrity="sha384-z3CBOpMFSI4D+GXPvBsSW5vXhm4MEzWuC/CycHv+vsuzuztOzPpomZimFLeWNOgk" crossorigin="anonymous">

<link rel="icon" type="image/png" href="/favicon.png">

  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">pulse code</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/blog">Blog</a></li>
        
      
        
          <li><a href="/projects">Projects</a></li>
        
      
        
          <li><a href="/about">About</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">
            Show more
            <span class="menu__sub-inner-more-trigger-icon"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
          </li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/tags">Blog Tags</a></li>
              
            
              
                <li><a href="/personal">Personal</a></li>
              
            
          </ul>
        </ul>
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/blog">Blog</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/tags">Blog Tags</a></li>
      
    
      
        <li><a href="/personal">Personal</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/blog/wsl2/">On The Bleeding Edge with WSL2</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-06-16
        </span>
      
      
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/linux/">linux</a>&nbsp;
        
          #<a href="/tags/wsl/">wsl</a>&nbsp;
        
          #<a href="/tags/docker/">docker</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <p>I've been a huge fan of WSL (Windows Subsystem for Linux) since it first came to Windows 10. In fact it's fair to say it has completely transformed how I do local development, run tools and my whole workflow. Naturally I was very interested in the news from Build announcing a new version of WSL, which seems to go by the rather functional (if descriptive) name &ldquo;WSL2&rdquo;</p>
<p>I'm not going to get too deep into what's new and exciting with WSL2, as I think the <a href="https://devblogs.microsoft.com/commandline/announcing-wsl-2/">announcement blog</a> covers it nicely</p>
<p>So&hellip; I've taken the plunge and I'm trying it out, it's been a bumpy ride so I thought I'd write some of my adventure up here. This is going to be one of those &ldquo;point in time&rdquo; posts which hopefully becomes obsolete or unnecessary as WSL2 evolves, becomes GA and stable.</p>
<h1 id="pre-requisites">Pre-Requisites</h1>
<p>For now WSL2 is only <a href="https://devblogs.microsoft.com/commandline/wsl-2-is-now-available-in-windows-insiders/">available as part of Windows Insiders and build 18917</a>. This was probably my first major point of trepidation, you need to join &ldquo;Fast Ring&rdquo; which is fairly bleeding edge. So far I've been ok, but frankly it makes me a little nervous and I'll be glad when it enters &ldquo;Slow Ring&rdquo; or preferably mainstream Windows 10</p>
<p>First thing you'll notice after updating to build 18917 (or above) is &hellip; very little has changed! 
Your existing installed WSL distro(s) will still be in v1 mode. What has changed is the <code>wsl.exe</code> command, and by running <code>wsl --set-version &lt;distro&gt; &lt;version&gt;</code> you can now upgrade/switch them to WSL2 mode</p>
<h1 id="switching-to-wsl2">Switching to WSL2</h1>
<p><strong>GOTCHA #1:</strong> Right now running <code>--set-version</code> to <a href="https://github.com/microsoft/WSL/issues/4102">upgrade to WSL2 fails in a lot of cases</a>. It didn't work for my main Ubuntu instance, and hasn't worked for several colleagues. There's something in the filesystem tripping it up, but hopefully there's a fix coming soon</p>
<p>My solution - I installed a second Ubuntu distro from the store. For reasons I don't know &ldquo;Ubuntu&rdquo; and &ldquo;Ubuntu-18.04&rdquo; are separate installs &amp; entries on the store but both install Ubuntu 18.04.2 in WSL.<br>
This let me have my old &ldquo;Ubuntu-18.04&rdquo; WSL at v1 (because I couldn't upgrade) and alongside &ldquo;Ubuntu&rdquo; which I switched to v2 without hitch.</p>
<p>So yes, you were probably wondering - you can have WSL1 and WSL2 side by side</p>
<h1 id="initial-impressions">Initial Impressions</h1>
<p><strong>It starts up <em>fast</em></strong>. I was nervous when they said WSL2 was a VM now, because virtual machines are complete rubbish. But somehow this starts up in 1 or 2 seconds, it's amazing, no idea how they've done this.</p>
<h1 id="filesystem">Filesystem</h1>
<p>The guidance now is to <strong>have all your files as part of the root WSL filesystem</strong> rather than &ldquo;cross access&rdquo; via <code>/mnt/c</code> which was how I worked in WSL1 previously (with some symlinks). In WSL2 keeping under root gives you native filesystem performance, and I certainly noticed the difference. NPM installs took half the time over WSL1 (I timed it!), git operations were much quicker, installing packages with apt was hugely snappier. Overall it really flies&hellip;</p>
<p>I opted to manually move all my config, installed packages, code and settings over from my WLS1 to WSL2 distros. This was just a lot of admin &amp; chore work really - and something I would rather not needed to do, but I could live it. In short, it's not that exciting to discuss here</p>
<p>What made some of this easier was the new way to access your WSL filesystems from Windows. Previously this was 100% absolutely not permitted, but the 1903 Windows update made this possible</p>
<p><strong>This is done via the special <code>\\wsl$\</code> UNC path</strong>. From here you can access any and all your distros, and even copy files between them.</p>
<blockquote>
<p>Note 1. Linux file permissions might not be preserved but the convenience outweighs that.</p>
</blockquote>
<blockquote>
<p>Note 2. You don't need to be on Windows Insiders, just 1903 or on WSL2 to use this new feature</p>
</blockquote>

  <img src="explorer.png"  class="left"  />


<h1 id="networking">Networking</h1>
<p><strong>UPDATE</strong> Since Insiders build 18975, the localhost issues have been resolved, so you are free to use localhost exactly as with WSL v1</p>
<p><strong>GOTCHA #2:</strong> Currently you can't access services running inside WSL2 via localhost. Say you fired up your Node.js app, it listens on port 3000, from Windows you normally hit http://localhost:3000 to access it. This worked on WSL1 but not WSL2.</p>
<p>The workaround is to get the IP address of a special bridge that WSL2 is using, within WSL2 this will br interface eth0. You can find the address out with <code>ip addr|grep eth0</code> it will be an RFC 1918 address probably something in the <code>172.18.81.0/16</code> range. The address will also change; a lot, every reboot and every time you close WSL2 you will likely get a new address. So I created an alias to display it</p>
<pre><code>alias wsl-ip=&quot;ip addr show eth0 | grep \&quot;inet 1\&quot; | awk '{print \$2}' | cut -d/ -f1&quot;
</code></pre><p>For me this is only major drawback of WSL2, especially as I do a lot of Node &amp; Python web development locally. Apparently it's very high on the list to be resolved so hopefully by the next release it will be a non-issue.</p>
<h1 id="vs-code">VS Code</h1>
<p>Naturally I'm using the <a href="https://code.visualstudio.com/docs/remote/remote-overview">new VS Code remote extensions</a> allowing me to work inside WSL. The extension does work with WSL2 however I've noticed one thing.</p>
<p><strong>GOTCHA #3:</strong> If you launch VS Code from within WSL2 using <code>code .</code> which I think a lot of people do, it will not work. This just launches VS Code in local/Windows mode and opens the folder via the <code>\\wsl$\Ubuntu\blah</code> path <strong>UPDATE</strong> This is now resolved and works as expected</p>
<p>To start VS Code with WSL2 you need to go via the &ldquo;Remote-WSL New Window&rdquo; command on the command pallet (either with Ctrl+Shift+P, or by clicking the small remote icon in the bottom right of VS Code). This starts VS Code in WSL mode in your default distro. This means need to make WSL2 your default with <code>wsl --set-default</code>, until <a href="https://github.com/microsoft/vscode-remote-release/issues/118">this update to the extension</a>. From there open your project directory as normal, you can also open them from the recents list, e.g. Ctrl+R</p>
<h1 id="docker">Docker</h1>
<p>With WSL2 you can finally install Docker fully in your distro, by this I mean the engine/service not just the CLI tools. This is huge! It means I can finally get rid of Docker For Windows 10, which is a pain and really slow.</p>
<p>I installed Docker with the standard get.docker script</p>
<pre><code>curl -fsSL https://get.docker.com/ | sh 
</code></pre><p>There's no service support in WSL (1 or 2) so you will need to start the daemon manually (this is something I've put in an alias)</p>
<pre><code>sudo /etc/init.d/docker start
</code></pre><blockquote>
<p>Note: If you previously have set an environmental variable DOCKER_HOST in your rc scripts to access Docker for Windows, you need to remove this and let the tools access /var/run/docker.sock</p>
</blockquote>
<p>I found having Docker in WSL2 to be really nice and worked without issue, it was great to be working natively with a local Docker engine again, and definitely much, MUCH faster.</p>
<p><strong>Gotcha #4:</strong> Sometimes I found my containers could not access the external network &amp; internet. Which when you're running apt, npm or pip inside your Dockerfile is a bit of a pain. I can't tell if this is just my system or a wider issue <a href="https://github.com/MicrosoftDocs/WSL/issues/422">but others have reported it</a>. A reboot makes this issue go away, and I think the localhost changes that are coming will hopefully fix this. In the mean time adding <code>--network host</code> to your docker commands was a short term fix</p>
<h1 id="summary">Summary</h1>
<p>So as you can see WSL2 is not without it's issues, however there's nothing show-stopping in there. In fact I'm writing this blog post from VS Code running with WSL2, which is running Jekyll allowing me to preview &amp; run my blog locally.</p>
<p>It's definitely not for the faint of heart at this stage, I expecting that to change of course as it approaches general release. As it stands I'm happy dealing with the few gotchas for the benefits WSL2 provides.</p>
<p>Pros:</p>
<ul>
<li>Much faster filesystem IO</li>
<li>Run side by side with WSL1</li>
<li>Access files from Windows with <code>\\wsl$\</code> (Not just WSL2)</li>
<li>Full Linux compatibility</li>
<li>Running Docker natively</li>
</ul>
<p>Cons:</p>
<ul>
<li>Lack of localhost support (coming soon!)</li>
<li>Switch / upgrade from WSL1 to WSL2 broken (fix coming)</li>
<li>VS Code remote support could improve</li>
</ul>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/blog/getting-on-the-go-kart/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Getting On The Go Kart</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/blog/cosmos-sharding/">
                  <span class="button__text">Squeezing &amp; Sharding Cosmos DB</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">pulse code</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2019 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
